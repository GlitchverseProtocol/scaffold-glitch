function init(){scene=new THREE.Scene,scene.fog=new THREE.FogExp2(0,.025);var e=new THREE.PointLight(16711935,1,100);e.position.set(-10,-10,-10),scene.add(e);var a=new THREE.AmbientLight(65535,.2);scene.add(a),labelRenderer=new CSS2DRenderer,labelRenderer.setSize(window.innerWidth,window.innerHeight),labelRenderer.domElement.style.position="absolute",labelRenderer.domElement.style.top="0px",document.body.appendChild(labelRenderer.domElement);var n=new THREE.AudioLoader,o=new THREE.AudioListener,t=new THREE.TextureLoader;for(let e=0;e<tokenData.length;e++)if("image/png"===tokenData[e].dataType){console.log("image");var s=t.load(tokenData[e].data),r=new THREE.BoxGeometry(1,1,1),i=new THREE.MeshBasicMaterial({map:s}),l=new THREE.Mesh(r,i);l.userData={hasSound:!1,velocity:new THREE.Vector3((Math.random()-.5)*velocityScale,(Math.random()-.5)*velocityScale,(Math.random()-.5)*velocityScale)},l.position.x=2*e-tokenData.length,shapes.push(l),scene.add(l)}else if("audio/ogg"===tokenData[e].dataType){if(console.log("audio/ogg"),!tokenData[e].data){console.warn("No data for audio");continue}(function(e){var a=new THREE.Audio(o),t=tokenData[e].contract;n.load(tokenData[e].data,function(n){a.setBuffer(n),a.setLoop(!0),sounds.push(a),console.log("loaded"),console.log(sounds);var o=new THREE.SphereGeometry(.5,32,32),s=new THREE.WireframeGeometry(o),r=new THREE.LineBasicMaterial({color:shapeColors[Math.floor(Math.random()*shapeColors.length)]}),i=new THREE.LineSegments(s,r);if(tokenData[e].isPrimary){console.log("isPrimary",e);var l=new THREE.SphereGeometry(.6,32,32),d=new THREE.MeshBasicMaterial({color:65280,transparent:!0,opacity:.5}),c=new THREE.Mesh(l,d);c.add(i),i=c}i.position.x=2*e-tokenData.length,i.userData={soundIndex:sounds.length-1,hasSound:!0,velocity:new THREE.Vector3((Math.random()-.5)*velocityScale,(Math.random()-.5)*velocityScale,(Math.random()-.5)*velocityScale)};var u=document.createElement("div");u.className="label",u.textContent=t,u.style.marginTop="-1em",u.style.fontFamily="Courier New, monospace",u.style.color="#00ff00";var p=new CSS2DObject(u);p.userData={sphere:i},p.position.y=.6,labels.push(p),scene.add(p),shapes.push(i),scene.add(i);for(let e=0;e<shapes.length-1;e++)for(let a=e+1;a<shapes.length;a++){r=new THREE.LineBasicMaterial({color:65535}),o=(new THREE.BufferGeometry).setFromPoints([shapes[e].position,shapes[a].position]);var m=new THREE.Line(o,r);m.userData={indices:[e,a]},scene.add(m),lines.push(m)}})})(e)}camera=new THREE.PerspectiveCamera(55,window.innerWidth/window.innerHeight,.01,1e3),camera.position.set(0,0,10),camera.lookAt(scene.position),renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),renderer.setSize(window.innerWidth,window.innerHeight),renderer.setClearColor("#000000"),document.body.appendChild(renderer.domElement),window.addEventListener("click",onDocumentMouseDown,!1)}function animate(){requestAnimationFrame(animate),shapes.forEach((e,a)=>{if(e.rotation.x+=.01,e.rotation.y+=.01,e.position.add(e.userData.velocity),(e.position.x<-5||e.position.x>5)&&(e.userData.velocity.x=-e.userData.velocity.x),(e.position.y<-5||e.position.y>5)&&(e.userData.velocity.y=-e.userData.velocity.y),(e.position.z<-5||e.position.z>5)&&(e.userData.velocity.z=-e.userData.velocity.z),e.userData.hasSound)if(e.userData.isPlaying=sounds[e.userData.soundIndex].isPlaying,e.userData.isPlaying){var n=Math.sin(Date.now()*pulsatingSpeed)*pulsatationAmplitude+1;e.scale.set(n,n,n)}else e.scale.set(1,1,1)}),lines.forEach(e=>{var a=e.userData.indices,n=(new THREE.BufferGeometry).setFromPoints([shapes[a[0]].position,shapes[a[1]].position]);e.geometry=n}),frameCount%2==0&&labels.forEach(e=>{e.position.copy(e.userData.sphere.position)}),frameCount++,render()}function render(){renderer.render(scene,camera),labelRenderer.render(scene,camera)}function onDocumentMouseDown(e){e.preventDefault(),mouse.x=e.clientX/window.innerWidth*2-1,mouse.y=-e.clientY/window.innerHeight*2+1,raycaster.setFromCamera(mouse,camera);var a=raycaster.intersectObjects(shapes);if(a.length>0){var n=a[0].object;if(n.userData.hasSound){var o=n.userData.soundIndex;sounds[o]?(console.log("soundIndex",o),n.userData.isPlaying?(console.log("stop"),sounds[o].stop(),n.userData.isPlaying=!1):(console.log("play"),sounds[o].play(),n.userData.isPlaying=!0)):console.log("Audio is not loaded yet")}}}import*as THREE from"three";import{CSS2DObject,CSS2DRenderer}from"three/addons/renderers/CSS2DRenderer.js";var camera,scene,renderer,labelRenderer,raycaster=new THREE.Raycaster,mouse=new THREE.Vector2;let sounds=[],shapes=[],lines=[],labels=[],velocityScale=.05,pulsatingSpeed=.005,pulsatationAmplitude=.15,shapeColors=[65535,16711935,16776960,255,8388736,32768],frameCount=0;init(),animate();